"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n){if(Object.prototype.hasOwnProperty.call(n,r)){e[r]=n[r]}}}return e};var defaults={width:0,height:0,basePath:""};function getComputedStyle(e,t){return function(n){if(window.getComputedStyle){return window.getComputedStyle(e,t)[n]}return e.currentStyle[n]}}function offsetParent(e){if(e.nodeName!=="HTML"&&getComputedStyle(e)("position")==="static"){return offsetParent(e.offsetParent)}return e}function getScrollOffset(){if(window.pageXOffset){return{x:window.pageXOffset,y:window.pageYOffset}}return{x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop}}function parseImageLink(e){var t=e.indexOf("#");if(t===-1){return{src:e,x:0,y:0,w:0,h:0}}var n=e.substring(0,t);var r=e.substring(t+1);if(r.substring(0,5)!=="xywh="){return{src:defaults.basePath+n,x:0,y:0,w:0,h:0}}var a=r.substring(5).split(",");return{src:defaults.basePath+n,x:+a[0],y:+a[1],w:+a[2],h:+a[3]}}function sneakpeek(e){defaults.basePath=e.basePath||defaults.basePath;var t=_extends({},defaults,e);var n=this;var r=[],a=void 0;n.ready(function(){r=n.remoteTextTracks();o();if(!a){r.addEventListener("addtrack",o)}});function o(){if(a){return}for(var e=0;e<r.length;e++){if(r[e].kind==="metadata"){a=r[e];a.mode="hidden";break}}if(!a){return}if(navigator.userAgent.toLowerCase().indexOf("android")!==-1){var o=n.controlBar.progressControl;var s=function e(){o.addClass("fake-active")};var i=function e(){o.removeClass("fake-active")};o.on("touchstart",s);o.on("touchend",i);o.on("touchcancel",i)}var f=document.createElement("div");f.className="vjs-sneakpeek-holder";var u=document.createElement("img");f.appendChild(u);u.className="vjs-sneakpeek";var c=n.duration();n.on("durationchange",function(){c=n.duration()});n.on("loadedmetadata",function(){c=n.duration()});var d=n.controlBar.progressControl;d.el().appendChild(f);function l(e){var r=getScrollOffset().x;var o=offsetParent(d.el()).getBoundingClientRect();var s=e.pageX;if(e.changedTouches){s=e.changedTouches[0].pageX}var i=(o.width||o.right)+r;var l=s||e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;l-=offsetParent(d.el()).getBoundingClientRect().left+r;var h=Math.floor((l-d.el().offsetLeft)/d.width()*c);var v=a&&a.cues.length;var p=0;var g=void 0;while(p<v){var m=a.cues[p];if(m.startTime<=h&&m.endTime>=h){g=parseImageLink(m.text);break}p++}if(typeof g==="undefined"){return}if(g.src&&u.src!==g.src){var w="";if(g.src[0]==="/"){w=n.currentSrc();w=w.substring(0,w.lastIndexOf("/"))}u.src=w+g.src}g.w=g.w||t.width;g.h=g.h||t.height;if(f.style.width!==g.w||f.style.height!==g.h){f.style.width=g.w+"px";f.style.height=g.h+"px"}u.style.left=-g.x+"px";u.style.top=-g.y+"px";var y=[g.y,g.w+g.x,g.y+g.h,g.x];u.style.clip="rect("+y.join("px,")+"px)";var x=g.w;var b=x/2;if(l+b>i){l=i-x}else if(l<b){l=0}else{l=l-b}f.style.left=l+"px"}function h(){f.style.left="-1000px"}d.on("mousemove",l);d.on("touchmove",l);d.on("mouseout",h);d.on("touchcancel",h);d.on("touchend",h);n.on("userinactive",h)}}exports.default=sneakpeek;